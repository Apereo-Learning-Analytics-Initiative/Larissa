{
    "_id":"_design/statements",
    "views":{
        "agentActivity":{
            "map":"function(doc){function addIfNotExists(string,array){if(array.indexOf(string)===-1){array[array.length]=string}}function toIFI(agentOrGroup){if(agentOrGroup.mbox){return{mbox:agentOrGroup.mbox}}if(agentOrGroup.mbox_sha1sum){return{mbox_sha1sum:agentOrGroup.mbox_sha1sum}}if(agentOrGroup.openID){return{openID:agentOrGroup.openID}}if(agentOrGroup.account){return{account:agentOrGroup.account}}throw'no IFI for '.JSON.stringify(agentOrGroup);}function addAgentsFrom(object,array){if(object.objectType==='Agent'){addIfNotExists(JSON.stringify(toIFI(object)),array)}else if(object.objectType==='Group'){for(var i in object.member){addIfNotExists(JSON.stringify(toIFI(object.member[i])),array)}}}function getAgents(doc,related){var result=[];addAgentsFrom(doc.actor,result);addAgentsFrom(doc.object,result);if(related){if(doc.authority){addAgentsFrom(doc.authority,result)}if(doc.context){if(doc.context.instructor){addAgentsFrom(doc.context.instructor,result)}if(doc.context.team){addAgentsFrom(doc.context.team,result)}}}return result}function addActivities(activities,array){for(var i in activities){addIfNotExists(activities[i].id,array)}}function addActivitiesFromContextActivities(contextActivities,array){if(contextActivities.parent){addActivities(contextActivities.parent,array)}if(contextActivities.grouping){addActivities(contextActivities.grouping,array)}if(contextActivities.category){addActivities(contextActivities.category,array)}if(contextActivities.other){addActivities(contextActivities.other,array)}}function getActivities(doc,related){var result=[];if(doc.object.objectType==='Activity'){result[result.length]=doc.object.id}if(related){if(doc.context&&doc.context.contextActivities){addActivitiesFromContextActivities(doc.context.contextActivities,result)}if(doc.object.objectType==='SubStatement'){var subResult=getActivities(doc.object,true);for(var i in subResult){addIfNotExists(subResult[i],result)}}}return result}if(doc.type==='VOIDED'){return}var agents=getAgents(doc,false);var related_agents=getAgents(doc,true);var activities=getActivities(doc,false);var related_activities=getActivities(doc,true);var registration=(doc.context&&doc.context.registration)?doc.context.registration:null;var auth=doc.authority;var verb=doc.verb.id;var stored=doc.stored;function doEmit(level,agent,activity){if(agent!==null){agent=JSON.parse(agent)}emit([auth,level,agent,activity,null,null,stored]);emit(['ALL',level,agent,activity,null,null,stored]);emit([auth,level,agent,activity,verb,null,stored]);emit(['ALL',level,agent,activity,verb,null,stored]);if(registration){emit([auth,level,agent,activity,null,registration,stored]);emit(['ALL',level,agent,activity,null,registration,stored]);emit([auth,level,agent,activity,verb,registration,stored]);emit(['ALL',level,agent,activity,verb,registration,stored])}}for(var i in agents){doEmit(1,agents[i],null);for(var j in activities){doEmit(1,agents[i],activities[j])}doEmit(3,agents[i],null);for(var j in related_activities){doEmit(3,agents[i],activities[j])}}for(var i in related_agents){doEmit(2,related_agents[i],null);for(var j in activities){doEmit(2,related_agents[i],activities[j])}doEmit(4,related_agents[i],null);for(var j in related_activities){doEmit(4,related_agents[i],related_activities[j])}}for(var i in activities){doEmit(1,null,activities[i]);doEmit(2,null,activities[i])}for(var i in related_activities){doEmit(3,null,related_activities[i]);doEmit(4,null,related_activities[i])}}"
        },
        "verbRegistration":{
            "map":"function(doc){function doEmit(verb,registration){emit([doc.authority,verb,registration,doc.stored]);emit(['ALL',verb,registration,doc.stored])}if(doc.type==='VOIDED'){return}doEmit(null,null);doEmit(doc.verb.id,null);if(doc.context&&doc.context.registration){doEmit(null,doc.context.registration);doEmit(doc.verb.id,doc.context.registration)}}"
        }
    }
}