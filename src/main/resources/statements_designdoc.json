{
    "_id":"_design/statements",
    "views":{
    	"agentActivity":{
            "map":"function(doc){if(doc.type==='VOIDED'){return}function diff(arrA,arrB){var result=[];for(var i=0;i<arrA.length;i++){if(arrB.indexOf(arrA[i])<0){result.push(arrA[i])}}return result}function sum(arrA,arrB){var result=arrA.slice();for(var i=0;i<arrB.length;i++){if(result.indexOf(arrB[i])<0){result.push(arrB[i])}}return result}function addIfNotExists(string,array){if(array.indexOf(string)<0){array.push(string)}}function toIFI(agentOrGroup){if(agentOrGroup.mbox){return{mbox:agentOrGroup.mbox}}if(agentOrGroup.mbox_sha1sum){return{mbox_sha1sum:agentOrGroup.mbox_sha1sum}}if(agentOrGroup.openID){return{openID:agentOrGroup.openID}}if(agentOrGroup.account){return{account:agentOrGroup.account}}throw'no IFI for '.JSON.stringify(agentOrGroup);}function addAgentsFrom(object,array){if(object.objectType==='Agent'){addIfNotExists(JSON.stringify(toIFI(object)),array)}else if(object.objectType==='Group'){for(var i in object.member){addIfNotExists(JSON.stringify(toIFI(object.member[i])),array)}}}function getAgents(doc,related){var result=[];addAgentsFrom(doc.actor,result);addAgentsFrom(doc.object,result);if(related){if(doc.authority){addAgentsFrom(doc.authority,result)}if(doc.context){if(doc.context.instructor){addAgentsFrom(doc.context.instructor,result)}if(doc.context.team){addAgentsFrom(doc.context.team,result)}}}return result}function addActivities(activities,array){for(var i in activities){addIfNotExists(activities[i].id,array)}}function addActivitiesFromContextActivities(contextActivities,array){if(contextActivities.parent){addActivities(contextActivities.parent,array)}if(contextActivities.grouping){addActivities(contextActivities.grouping,array)}if(contextActivities.category){addActivities(contextActivities.category,array)}if(contextActivities.other){addActivities(contextActivities.other,array)}}function getActivities(doc,related){var result=[];if(doc.object.objectType==='Activity'){result[result.length]=doc.object.id}if(related){if(doc.context&&doc.context.contextActivities){addActivitiesFromContextActivities(doc.context.contextActivities,result)}if(doc.object.objectType==='SubStatement'){var subResult=getActivities(doc.object,true);for(var i in subResult){addIfNotExists(subResult[i],result)}}}return result}var agents=getAgents(doc,false);var related_agents=getAgents(doc,true);var activities=getActivities(doc,false);var related_activities=getActivities(doc,true);var registration=doc.context?doc.context.registration:null;var auth=doc.authority;var verb=doc.verb.id;var stored=doc.stored;function doEmit(level,agent,activity){if(agent!==null){agent=JSON.parse(agent)}emit([auth,level,agent,activity,null,null,stored]);emit(['ALL',level,agent,activity,null,null,stored]);emit([auth,level,agent,activity,verb,null,stored]);emit(['ALL',level,agent,activity,verb,null,stored]);if(registration){emit([auth,level,agent,activity,null,registration,stored]);emit(['ALL',level,agent,activity,null,registration,stored]);emit([auth,level,agent,activity,verb,registration,stored]);emit(['ALL',level,agent,activity,verb,registration,stored])}}for(var i in agents){doEmit(1,agents[i],null);for(var j in activities){doEmit(1,agents[i],activities[j])}doEmit(3,agents[i],null);for(var j in related_activities){doEmit(3,agents[i],activities[j])}}for(var i in related_agents){doEmit(2,related_agents[i],null);for(var j in activities){doEmit(2,related_agents[i],activities[j])}doEmit(4,related_agents[i],null);for(var j in related_activities){doEmit(4,related_agents[i],related_activities[j])}}for(var i in activities){doEmit(1,null,activities[i]);doEmit(2,null,activities[i])}for(var i in related_activities){doEmit(3,null,related_activities[i]);doEmit(4,null,related_activities[i])}function doRefEmitForLevel(referrerAuths,level,verbs,registrations,agentsOnlyInReferee,agentsMinusOnlyInReferee,activities,activitiesOnlyInReferee,referrerStored,referrerId){var referrerId={_id:referrerId};for(var a=0;a<referrerAuths.length;a++){for(var b=0;b<verbs.length;b++){for(var c=0;c<registrations.length;c++){for(var d=0;d<agentsOnlyInReferee.length;d++){var agentOnlyInReferee=JSON.parse(agentsOnlyInReferee[d]);for(var e=0;e<activities.length;e++){emit([referrerAuths[a],level,agentOnlyInReferee,activities[e],verbs[b],registrations[c],referrerStored],referrerId)}emit([referrerAuths[a],level,agentOnlyInReferee,null,verbs[b],registrations[c],referrerStored],referrerId)}for(var d=0;d<activitiesOnlyInReferee.length;d++){for(var e=0;e<agentsMinusOnlyInReferee.length;e++){var agentOb=JSON.parse(agentsMinusOnlyInReferee[e]);emit([referrerAuths[a],level,agentOb,activitiesOnlyInReferee[d],verbs[b],registrations[c],referrerStored],referrerId)}emit([referrerAuths[a],level,null,activitiesOnlyInReferee[d],verbs[b],registrations[c],referrerStored],referrerId)}}}}}function emitReferrers(doc,rootAgents,rootActivities,parentChainAgents,parentChainActivities,allVerbs,allRegistrations){if(!doc.referrers){return}for(var i=0;i<doc.referrers.length;i++){var ref=doc.referrers[i];var refAgents=getAgents(ref,false);var refRelatedAgents=getAgents(ref,true);var refActivities=getActivities(ref,false);var refRelatedActivities=getActivities(ref,true);var refRegistration=ref.context?ref.context.registration:null;var refAuth=ref.authority;var refVerb=ref.verb.id;var refStored=ref.stored;allVerbs=sum(allVerbs,[refVerb]);if(refRegistration){allRegistrations=sum(allRegistrations,[refRegistration])}parentChainAgents=sum(parentChainAgents,refAgents);var agentsOnlyInRoot=diff(rootAgents,parentChainAgents);var allAgents=sum(parentChainAgents,rootAgents);var agentsMinusOnlyInRoot=diff(allAgents,agentsOnlyInRoot);parentChainActivities=sum(parentChainActivities,refActivities);var allActivities=sum(parentChainActivities,rootActivities);var activitiesOnlyInRoot=diff(rootActivities,parentChainActivities);var refAuths=[refAuth,'ALL'];var level=1;doRefEmitForLevel(refAuths,level,allVerbs,allRegistrations,agentsOnlyInRoot,agentsMinusOnlyInRoot,allActivities,activitiesOnlyInRoot,ref.stored,ref.id);emitReferrers(ref,rootAgents,rootActivities,parentChainAgents,parentChainActivities,allVerbs,allRegistrations)}}emitReferrers(doc,agents,activities,[],[],[verb,null],(registration?[registration,null]:[null]))};"
            	},
        "verbRegistration":{
            "map":"function(doc){if(doc.type==='VOIDED'){return}function diff(arrA,arrB){var result=[];for(var i=0;i<arrA.length;i++){if(arrB.indexOf(arrA[i])<0){result.push(arrA[i])}}return result}function sum(arrA,arrB){var result=arrA.slice();for(var i=0;i<arrB.length;i++){if(result.indexOf(arrB[i])<0){result.push(arrB[i])}}return result}var auth=doc.authority;var verb=doc.verb.id;var registration=doc.context?doc.context.registration:null;var stored=doc.stored;var auths=['ALL',auth];for(var i=0;i<auths.length;i++){emit([auths[i],null,null,stored]);emit([auths[i],verb,null,stored]);if(registration){emit([auths[i],null,registration,stored]);emit([auths[i],verb,registration,stored])}}function emitReferrers(doc,rootVerb,rootRegistration,parentChainVerbs,parentChainRegistrations){if(!doc.referrers){return}for(var i=0;i<doc.referrers.length;i++){var ref=doc.referrers[i];var refAuths=['ALL',ref.authority];var refVerb=ref.verb.id;var refRegistration=ref.context?ref.context.registration:null;var refStored=ref.stored;var referrerId={_id:ref.id};parentChainVerbs=sum(parentChainVerbs,[refVerb]);if(refRegistration){parentChainRegistrations=sum(parentChainRegistrations,[refRegistration])}var ittRegistrations=rootRegistration?sum(parentChainRegistrations,[rootRegistration]):parentChainRegistrations;if(refVerb!==rootVerb){for(var j=0;j<refAuths.length;j++){for(var k=0;k<ittRegistrations.length;k++){emit([refAuths[j],rootVerb,ittRegistrations[k],refStored],referrerId)}emit([refAuths[j],rootVerb,null,refStored],referrerId)}}var ittVerbs=diff(parentChainVerbs,[rootVerb]);if(rootRegistration&&refRegistration!==rootRegistration){for(var j=0;j<refAuths.length;j++){for(var k=0;k<ittVerbs.length;k++){emit([refAuths[j],ittVerbs[k],rootRegistration,refStored],referrerId)}emit([refAuths[j],null,rootRegistration,refStored],referrerId)}}emitReferrers(ref,rootVerb,rootRegistration,parentChainVerbs,parentChainRegistrations)}}emitReferrers(doc,verb,registration,[],[])};"
            	}
    }
}